{% extends '::base.html.twig' %}
{%block title%}{%trans%}titre_statistique{%endtrans%}{% endblock%}

{% block body %}
<style>
	.divFieldSet
	{
		border:1px #dddddd solid;                         
		position:relative;
		padding: 5px ;                
		font-size: 9pt;
		margin-top:5px;
	}
	.divLegende
	{
		border: 1px #dddddd solid;
		width: 50%;
		position: absolute;
		margin: -10px 30% 0 30%;
		margin-left:25%;
		background: white;
		font-weight: bold;
		text-align: center;
	}
	.boutonMoyen
	{
		width:120px;
	}
</style>

	<div class="row"> 
        <div class="col-lg-12">
            <h3 class="page-header">
               <div>
					{{"nbr_entreprise_crees_jours"|trans}}
				</div>
            </h3>
        </div>
    </div>
	
<div class="container" style="width:100%">   
	<div class="col-md-12">
        <form method="POST" {{ form_enctype(form) }}>
			<div class="row divFieldSet text-center">	
				<div class="divLegende">{%trans%}choix_periode_repartition{%endtrans%}</div>	
					<br/><br/> 
				<div class="col-sm-4 text-center">                                 
					<a class="btn btn-default boutonMoyen" disabled="true">{%trans%}jours{%endtrans%}</a>
                </div>
				
				<div class="col-sm-4 text-center">                               
                    <a href="{{path('statistiques-periode-graphe-mois')}}"  class="btn btn-default boutonMoyen">{%trans%}mois{%endtrans%}</a>
                </div>
				
				<div class="col-sm-4 text-center">                               
                    <a href="{{path('statistiques-periode-graphe-annee')}}" class="btn btn-default boutonMoyen">{%trans%}annee{%endtrans%}</a>
                </div>                   
			</div>

			<br/>
			<div class=" row col-sm-12 text-center">
				<div class="col-sm-4">
				{{ form_widget(form.typeGraphe.0, {'attr': {'checked': 'checked' }}) }}{{ form_label(form.typeGraphe.0) }}
				</div>

				<div class="col-sm-4">
				{{ form_widget(form.typeGraphe.1, {'attr': {'class': '' }}) }}{{ form_label(form.typeGraphe.1) }}
				</div>
				
				<div class="col-sm-4">
				{{ form_widget(form.typeGraphe.2, {'attr': {'class': '' }}) }}{{ form_label(form.typeGraphe.2) }}
				</div>
			</div>
			<br/><br/>
					
			<div class="row text-center">
				<div class="form-group col-sm-4"></div>
				<div class="form-group col-sm-2" style="min-width:175px">
					<label>{%trans%}date_debut_creation{%endtrans %}</label>                                
					<div class="input-group date" id="datetimepicker1">
						{{ form_widget(form.dateCreationDebut, {'attr': {'class': 'datepicker1 form-control'}}) }}
						<span class="input-group-addon">
							<span class="glyphicon glyphicon-calendar"></span>
						</span>
					</div>
				</div>
				<div class="form-group col-sm-2" style="min-width:175px">
					<label>{%trans%}date_fin_creation{%endtrans %}</label> 
					<div class="input-group date" id="datetimepicker2">
						{{ form_widget(form.dateCreationFin, {'attr': {'class': 'datepicker2 form-control'}}) }}
						<span class="input-group-addon">
							<span class="glyphicon glyphicon-calendar"></span>
						</span>
					</div>
				</div>

				<div class="text-left" style="margin-top:25px">
					<button type="submit"  class="btn btn-info" >{%trans%}valider{%endtrans %}</button>
				</div>
			</div>
		{{ form_rest(form) }} 
		</form>
			</div>  
			<br/>
			<br/>
			<br/>
		<div id="container1" style=" margin: 0 auto"></div>
    </div>  
</div> 

{% endblock %}

{%block javascripts%}
    {{parent()}}        
	 		 
	<script type="text/javascript" src="{{asset('js/momentlocal.js') }}"></script>
	<script type="text/javascript" src="{{asset('datepicker/js/bootstrap-datetimepicker.min.js')}}"></script>		
    <script src="{{asset('js/highcharts.js')}}" charset="utf-8"></script>
    <script src="{{asset('js/modules/exporting.js')}}" charset="utf-8"></script>
   
<script type="text/javascript">
$(function () {

$('#datetimepicker1').datetimepicker({locale: 'fr', format: 'DD-MM-YYYY', maxDate : 'now'});

$('#datetimepicker2').datetimepicker({locale: 'fr', format: 'DD-MM-YYYY', maxDate : 'now'});

$('#statGrapheType_dateCreationFin').attr("readonly", true);

$("#datetimepicker1").on("dp.change", function (e) {
	if(e.date)
	{
		todayDate = new Date();
		startDate = new Date(e.date);
		endDate = new Date(e.date);
		endDate.setDate(endDate.getDate() + 30);
		previousMinDate = $('#datetimepicker2').data("DateTimePicker").minDate();
		previousMaxDate = $('#datetimepicker2').data("DateTimePicker").maxDate();
		
		if (endDate.getTime() > todayDate.getTime())
		{
			endDate=todayDate;
		}
		if (endDate.getTime() <  startDate.getTime())
		{
			endDate=startDate;
		}

		if(previousMaxDate != false && previousMaxDate < startDate)
		{
			$('#datetimepicker2').data("DateTimePicker").maxDate(endDate);
			$('#datetimepicker2').data("DateTimePicker").minDate(startDate);	
		}
		else
		{
			$('#datetimepicker2').data("DateTimePicker").minDate(startDate);	
			$('#datetimepicker2').data("DateTimePicker").maxDate(endDate);		
		}
		$('#datetimepicker2').data("DateTimePicker").date(endDate);
		$('#statGrapheType_dateCreationFin').attr("readonly", false);
	}
});

var tab = {{tabResult|json_encode()|raw}};

	$('#container1').highcharts({
	chart: {
		type: '{{typeGraphe}}'
	},
	title: {
		text: '{{"nbr_entreprise_crees_jours"|trans|e('js') }}'
	},
	subtitle: {
		text: '<a href="#">{{"du"|trans}} {{dateDebut|localizeddate("none", "none", locale, null, "dd MMMM y")}} {{"au"|trans}} {{dateFin|localizeddate("none", "none", locale, null, "dd MMMM y")}}</a>'
	},
	xAxis: {
		type: 'category',
		labels: {
			rotation: 25,
			align: 'center',
			style: {
				fontSize: '8px',
				fontFamily: 'Verdana, sans-serif'
			}
		}
	},
	yAxis: {
		min: 0,
		title: {
			text: '{{"message_nbr_entreprises"|trans|e('js') }}'
		}
	},
	legend: {
		enabled: true
	},
	tooltip: {
		pointFormat: '{{"message_nbr_entreprises"|trans|e('js') }}: <b>{point.y:.0f} </b>',
	},
	plotOptions: {
		histogramme: {
            dataLabels: {
                enabled: true,
				formatter: function() {
						if(this.y != 0) {
							return this.y;
						}   
                    },
            },
            enableMouseTracking: true
        },
        line: {
            dataLabels: {
                enabled: true
            },
            enableMouseTracking: true
        },
		pie: {
                allowPointSelect: true,
                cursor: 'pointer',
                dataLabels: {
                    enabled: true,
					formatter: function() {
						if(this.y != 0) {
							return Math.round(this.percentage*100)/100 + ' %';
						}   
                    },
                    distance: 20,
					color:'black',
					fontSize: '14px',
					style: {
						textShadow: '1px 1px 2px white'
					}
                },
                showInLegend: true
            }
    },
		series: [{
				name: '{{"message_nbr_entreprises"|trans|e('js') }}',
				data: tab,
				color: Highcharts.getOptions().colors[10],
				dataLabels: {
					enabled: true,
					rotation: 0,
					align: 'center',
					x: 0,
					y: 0,
					style: {
						fontFamily: 'Verdana, sans-serif',
					}
				}
			}]
	});

});



</script>

{% endblock %}	
